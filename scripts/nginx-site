upstream $SITE {
        server unix:/var/run/$SITE-gunicorn.sock fail_timeout=0;
}

server {
        access_log /var/log/nginx/$SITE.access.log;
        error_log /var/log/nginx/$SITE.error.log;
        server_name $SITE.org www.$SITE.org;

        location /admin {
                rewrite ^(.*)$ https://$SITE$1 permanent;
        }

        location /media {
                root /var/www/$SITE/;
                expires 30d;
                #access_log off;
        }

	# maybe with collectstatic this is useless
        location ^/admin/media/ {
                root /var/www/$SITE/env/lib/python2.6/site-packages/django/contrib/admin/media/;
                expires 30d;
                access_log off;
        }

        location / {
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header Host $http_host;
                proxy_redirect off;

                if (!-f $request_filename) {
                        proxy_pass http://$SITE
                        break;
                }
        }

}
